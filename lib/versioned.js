"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=versioned;exports.prefixify=prefixify;var _fs=require("fs");var _fs2=_interopRequireDefault(_fs);var _path=require("path");var _path2=_interopRequireDefault(_path);var _glob=require("glob");var _glob2=_interopRequireDefault(_glob);var _semver=require("semver");var _semver2=_interopRequireDefault(_semver);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function versioned(router){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var current_version=options.hasOwnProperty("current_version")?options.current_version:require(process.cwd()+"/package.json").version;var supported_versions=options.hasOwnProperty("supported_versions")?options.supported_versions:false;var globPath=void 0;if(options.hasOwnProperty("glob")){globPath=options.glob}else{var basePath=options.hasOwnProperty("base_path")?options.base_path:process.cwd()+"/endpoints";globPath=basePath+"/v*"}var versioned_directories=_glob2.default.sync(globPath,options.hasOwnProperty("glob_options")?options.glob_options:{});versioned_directories.forEach(function(dirname){console.log("versioned \tScanning directory: "+dirname);var endpoints=_glob2.default.sync(dirname+"/**/*.js");var v=dirname.split("/").pop();endpoints.forEach(function(file){console.log("versioned \tRegistering endpoint: "+file);var routes=require(file).default;var route_prefix=options.hasOwnProperty("route_prefix")?options.route_prefix:"";if(_semver2.default.satisfies(current_version,v)){routes(router,prefixify(""+route_prefix))}else{routes(router,prefixify(route_prefix+"/"+v))}})});return function(ctx,next){router.routes()(ctx,function(){router.allowedMethods()(ctx,next)})}}function prefixify(prefix){return function(path){return""+prefix+path}}
